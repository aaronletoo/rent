<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link href="lib/ligerUI/skins/Aqua/css/ligerui-all.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="css/main.css"/>
    <script src="lib/json2.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerDialog.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerTextBox.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerCheckBox.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerComboBox.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerGrid.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerDateEditor.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerSpinner.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerButton.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/rightHidePanel.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            $.post($.URL.collector.list,null,collectorListCallback,"json");
//            $.post($.URL.sensor.getMongoDataLastList,null,lastTimeCallback,"json");
        });
//        $.ajaxSetup({
//            async: false
//        });
        var gridData =[];
        var lastTime="";
        function collectorListCallback(data){
            if(data.code=200){
                gridData.Rows=data.data;
                gridData.Total=data.length;
                f_initGrid();
            }
        }
//        function lastTimeCallback(data){
//
//            if (data.code == 200) {
//                lastTime = data.data.time;
////                alert(lastTime);
//            }    }



        var grid;
        var sensorTime;
        function f_initGrid(){
            grid = $("#collectorGrid").ligerGrid({
                columns:[
                    {name:'number',display:'编号',width:'auto'},
                    {name:'id',display:'序号',width:'auto'},
              //    {name:'groupName',display:'测量组',width:'auto'},
                    {name:'name',display:'采集仪名称',width:'auto'},
                    {name:'description',display:'采集仪描述',width:'auto'},
                    {name:'lastMessageTime',display:'最后通信时间',width:'auto'
                        ,render:function(item){
                        var num =item.number;
                        var tempURL = $.URL.sensors.getCollectorStatus;
                        var myURL = tempURL + num.toString();
//                        alert(myURL);
//                        $.get(myURL+".html",null,lastTimeCallback,"jsonp") ;
//                        function lastTimeCallback(result) {
////                            alert(result["lastDate"].toString());
//                            sensorTime = result["lastDate"].toString();
//                        }
                        $.ajax({
                            url: myURL+".html",
                            async:false,
                            dataType:'jsonp',
                            success:(function(result){
                                sensorTime = result["lastDate"].toString();
                            })
                        });
                        return sensorTime;
                    }
                    },
                    { display: '状态', name: 'status',width:'auto' }
                ],
                data:gridData,clickToEdit: false, isScroll: true, usePager: false,
                width:'auto',resizable:true
            }); }






    </script>

    <style type="text/css">
        .l-div {height: 30px;margin-top: 10px}
        .l-span-edit-com{margin-left: 10px;  width: 70px;float: left;margin-top:2px}
        .l-edit-com{width: 60px; margin-left: 10px; float: left;}
    </style>
</head>
<body>
<!--<p>测试页面是否正常</p>-->
<div id="collectorContainer">
    <div id="collectorGrid" style="width: 100%;margin-top: 5px;"/>
</div>
<br/>
</body>
</html>