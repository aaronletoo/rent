<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link href="lib/ligerUI/skins/Aqua/css/ligerui-all.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="css/main.css"/>
    <script src="lib/json2.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerDialog.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerTextBox.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerCheckBox.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerComboBox.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerGrid.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerDateEditor.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerSpinner.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerButton.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/rightHidePanel.js"></script>
    <script type="text/javascript">
        var currentMonitor,grid;
       var  sensorTime=" ";
        $(document).ready(function() {
            $.post($.URL.sensor.homePage,{"fStatus":"true"},gridCallback,"json");
        });
        $.ajaxSetup({
            async: false
        });
        var  number;
        var gridData = {};
        function gridCallback(data){
            gridData.Rows = data.data;
            gridData.Total = data.length;
            number=data.data.number;
            f_initGrid();
        }
        function f_initGrid(){
            grid = $("#monitorGrid").ligerGrid({
                columns:[
                    {name:'number',display:'编号',width:'auto'},
                    {name:'name',display:'传感器',width:'auto'},
                    {name:'groupName',display:'监测组',width:'auto'},
                    {name:'areaName',display:'监测区域',width:'auto'},
                    {name:'collectorName',display:'采集仪名称',width:'auto'},
                    {name:'lastMessageTime',display:'最后通信时间',width:'auto'
                       ,render:function(item){
                            var num =item.number;
                        var tempURL = $.URL.sensors.getWarnCondition;
                        var myURL = tempURL + num.toString();
                        $.get(myURL+".html",null,lastTimeCallback,"jsonp") ;
//                        $.post($.URL.sensor.getMongoDataLastTimeByNumber,{"number":"number"},lastTimeCallback,"json");
//                        $.ajax({
//                            url: $.URL.sensor.getMongoDataLastList,
//                            async:false,
//                            type:'POST',
//                            dataType:'json',
//                            success:
                           function lastTimeCallback(result) {
//                               alert(result["LastData"]);
                          sensorTime = result["LastData"].toString();
//                            }
//                        })
//                        return sensorTime;

                   }
                        return curDateCallback();
                    }
                    },



                    { display: '状态', name: 'sensorStatus',width:'auto'
//                        ,render: function{
////                        //日期转换
////                    SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd hh:mm:ss ");
//
//                        var dt = Date.parse(sensorTime.replace(/-/g,"/"));
//                        dt = new Date(dt);
//                        var nowdt=new Date();
//                        alert(dt);  alert(nowdtdt);
//                  // Date dateStr = sdf.parse(dateString);
//                    }
                    },
                    { display: '操作', isSort: false,  render: function (rowdata, rowindex, value)
                    {
                        var h = "";
                        h += "<a href='javascript:getInfo(" + rowindex + ")'>查看</a> ";
                        return h;
                    }
                    }
                ],
                data:gridData,clickToEdit: false, isScroll: true, usePager: false,
                width:'auto',resizable:true
            });
        }

        function curDateCallback() {
            return sensorTime;
        }


        function getInfo(rowindex){
            currentMonitor = grid.getRow(rowindex);
//            var jsonString  = $.toJSON(currentMonitor);
//            number = $.evalJSON(jsonString).number;
            //  alert( currentMonitor.number);
            $("#realInfoTab").load("dashboard/realData.html");
        }

    </script>

    <style type="text/css">
        .l-div {height: 30px;margin-top: 10px}
        .l-span-edit-com{margin-left: 10px;  width: 70px;float: left;margin-top:2px}
        .l-edit-com{width: 60px; margin-left: 10px; float: left;}
    </style>
</head>
<body>
<!--<p>测试页面是否正常</p>-->
<div id="monitorContainer">
    <div id="monitorGrid" style="width: 100%;margin-top: 5px;"/>
</div>
<br/>
</body>
</html>