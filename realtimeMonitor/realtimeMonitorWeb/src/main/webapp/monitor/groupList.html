<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link href="lib/ligerUI/skins/Aqua/css/ligerui-all.css" rel="stylesheet" type="text/css" />
    <script src="lib/json2.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerDialog.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerTextBox.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerCheckBox.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerComboBox.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerGrid.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerDateEditor.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerSpinner.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function(){
            $.post($.URL.group.list,null,listCallBack,"json");
        });

        var groupGridData = {};
        function listCallBack(data) {
            if(data.code == 200) {
                groupGridData.Rows = data.data;
                groupGridData.Total = data.length;
                f_initGrid();
            }
        }

        var g,manager;

        function f_initGrid() {
            g=manager=$("#groupGrid").ligerGrid({
                        columns:[
                            {name:'id',display:'主键',width:'auto',type:'int',frozen:'true'},
                            {name:'name',display:'组名',width:'auto',editor:{type:'text'}},
                            {name:'description',display:'描述',width:'auto',editor:{type:'text'}},
                            {name:'createtime',display:'创建时间',width:'auto',frozen:'true'},
                            {display:'操作',isSort:false,width:120,render:function(rowdata,rowindex,value){
                                var h = "";
                                if(!rowdata._editing){
                                    h += "<a href='javascript:beginEdit(" + rowindex + ")'>修改</a>"+" ";
                                    h += "<a href='javascript:deleteRow("+ rowindex + ")'>删除</a>";
                                }
                                else{
                                    h += "<a href='javascript:endEdit(" + rowindex + ")'>提交</a> ";
                                    h += "<a href='javascript:cancelEdit("+ rowindex + ")'>取消</a>" ;
                                }
                                return h;
                            }}
                        ],
                        onSelectRow:function(rowdata,rowindex) {
                            $("#txtrowindex").val(rowindex);
                        },
                        enabledEdit:true,clickToEdit:false,isScroll:false,
                        data:groupGridData,width:'100%'
                    }
            );
        }

        function beginEdit(rowid) {
            manager.beginEdit(rowid);
        }

        function cancelEdit(rowid) {
            manager.cancelEdit(rowid);
        }

        function endEdit(rowid) {
            manager.endEdit(rowid);
            var row = manager.getRow(rowid);
            var jsonString = $.toJSON(row);
            $.post($.URL.group.update,{"jsonString":jsonString},updateCallBack,"json");
        }

        function updateCallBack(data) {
            if(data.code == 200) {
                $.post($.URL.group.list,null,listCallBack,"json");
                $.ligerDialog.success(data.message);
            }
            else {
                $.post($.URL.group.list,null,listCallBack,"json");
                $.ligerDialog.warn(data.message);
            }
        }

        function deleteRow(rowid) {
            if(confirm('确定删除？')) {
                var row = manager.getRow(rowid);
                var jsonString = $.toJSON(row);
                $.post($.URL.group.delete,{"jsonString":jsonString},deleteCallBack,"json");
                manager.deleteRow(rowid);
            }
        }

        function deleteCallBack(data) {
            if(data.code == 200) {
                $.ligerDialog.success("成功删除！");
            }
            else {
                $.ligerDialog.warn("删除失败！");
            }
        }
        </script>

    <style type="text/css">
        .l-table-edit {}
        .l-table-edit-td{ padding:4px;}
        .l-button-submit{width:80px; float:left; margin-left:10px; padding-bottom:2px;}
    </style>

</head>
<body>
<!--      按钮弹出框 -->
<div>
    <input type="button" value="添加" id="addSubmitBtn" class="l-button-submit" />
    <div class="l-clear"></div>
    <div id="groupGrid"></div>
</div>
</body>
</html>