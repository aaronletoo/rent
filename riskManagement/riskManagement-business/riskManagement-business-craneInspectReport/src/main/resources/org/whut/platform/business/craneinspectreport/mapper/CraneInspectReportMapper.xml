<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.whut.platform.business.craneinspectreport.mapper.CraneInspectReportMapper">
    <sql id="craneInspectReport_fields">
		ID,REPORTNUMBER,UNITADDRESS,ADDRESSID,ORGANIZECODE,USEPOINT,SAFEMANAGER,CONTACTPHONE,EQUIPMENTVARIETY,UNITNUMBER,MANUFACTUREUNIT,MANUFACTURELICENSENUMBER,MANUFACTUREDATE,SPECIFICATION,PNUMBER,WORKLEVEL,LNG,LAT,SINGLEPICURL,TYPEPICURL,RATEDLIFTWEIGHT
	</sql>

    <resultMap id="craneInspectReportResultMap" type="CraneInspectReport">
        <id property="id" column="ID" />
        <result property="reportNumber" column="REPORTNUMBER" />
        <result property="unitAddress" column="UNITADDRESS" />
        <result property="addressId" column="ADDRESSID" />
        <result property="organizeCode" column="ORGANIZECODE" />
        <result property="userPoint" column="USEPOINT" />
        <result property="safeManager" column="SAFEMANAGER" />
        <result property="contactPhone" column="CONTACTPHONE" />
        <result property="equipmentVariety" column="EQUIPMENTVARIETY" />
        <result property="unitNumber" column="UNITNUMBER" />
        <result property="manufactureUnit" column="MANUFACTUREUNIT" />
        <result property="manufactureLicenseNumber" column="MANUFACTURELICENSENUMBER" />
        <result property="manufactureDate" column="MANUFACTUREDATE" />
        <result property="specification" column="SPECIFICATION" />
        <result property="pNumber" column="PNUMBER" />
        <result property="workLevel" column="WORKLEVEL" />
        <result property="lng" column="LNG" />
        <result property="lat" column="LAT" />
        <result property="singlePicURL" column="SINGLEPICURL"/>
        <result property="typePicURL" column="TYPEPICURL"/>
        <result property="riskValue" column="RISKVALUE"/>
        <result property="ratedLiftWeight" column="RATEDLIFTWEIGHT"/>
        <result property="craneNumber" column="CRANENUMBER"/>
    </resultMap>

    <insert id="insert" parameterType="CraneInspectReport" keyProperty="id"
            useGeneratedKeys="true">
        INSERT INTO
        craneinspectreport(
        <include refid="craneInspectReport_fields" />
        )
        VALUES (#{id}, #{reportNumber}, #{unitAddress},#{addressId},#{organizeCode},#{userPoint},#{safeManager},#{contactPhone},#{equipmentVariety},#{unitNumber},#{manufactureUnit},#{manufactureLicenseNumber},#{manufactureDate},#{specification},#{pNumber},#{workLevel},#{lng},#{lat},#{singlePicURL},#{typePicURL},#{ratedLiftWeight});
        <selectKey resultType="long" keyProperty="id" order="AFTER">
            select
            LAST_INSERT_ID() as id
        </selectKey>
    </insert>
    <insert id="batchInsert" parameterType="java.util.List" useGeneratedKeys="true">
        <selectKey resultType="long" keyProperty="id" order="AFTER">
            select
            LAST_INSERT_ID() as id
        </selectKey>
        INSERT INTO
        craneinspectreport(
        <include refid="craneInspectReport_fields"/>)
        values
        <foreach collection="list" item="item" index="index" separator=",">
            (#{item.id},#{item.reportNumber},#{item.unitAddress},#{item.addressId},#{item.organizeCode},#{item.userPoint},#{item.safeManager},#{item.contactPhone},#{item.equipmentVariety},#{item.unitNumber},#{item.manufactureUnit},#{item.manufactureLicenseNumber},#{item.manufactureDate},#{item.specification},#{item.pNumber},#{item.workLevel},#{item.lng},#{item.lat},#{item.singlePicURL},#{item.typePicURL},#{item.ratedLiftWeight})
        </foreach>
    </insert>
    <update id="update" parameterType="CraneInspectReport">
        UPDATE  craneinspectreport
        <set>
            <if test="unitAddress!=null" >UNITADDRESS=#{unitAddress},</if>
            <if test="addressId!=null" >ADDRESSID=#{addressId},</if>
            <if test="organizeCode!=null" >ORGANIZECODE=#{organizeCode},</if>
            <if test="userPoint!=null" >USEPOINT=#{userPoint},</if>
            <if test="safeManager!=null" >SAFEMANAGER=#{safeManager},</if>
            <if test="contactPhone!=null" >CONTACTPHONE=#{contactPhone},</if>
            <if test="equipmentVariety!=null" >EQUIPMENTVARIETY=#{equipmentVariety},</if>
            <if test="unitNumber!=null" >UNITNUMBER=#{unitNumber},</if>
            <if test="manufactureUnit!=null" >MANUFACTUREUNIT=#{manufactureUnit},</if>
            <if test="manufactureLicenseNumber!=null">MANUFACTURELICENSENUMBER=#{manufactureLicenseNumber},</if>
            <if test="manufactureDate!=null" >MANUFACTUREDATE=#{manufactureDate},</if>
            <if test="specification!=null" >SPECIFICATION=#{specification},</if>
            <if test="pNumber!=null" >PNUMBER=#{pNumber},</if>
            <if test="workLevel!=null" >WORKLEVEL=#{workLevel},</if>
            <if test="singlePicURL!=null">SINGLEPICURL=#{singlePicURL},</if>
            <if test="typePicURL!=null">TYPEPICURL=#{typePicURL},</if>
            <if test="ratedLiftWeight!=null">RATEDLIFTWEIGHT=#{ratedLiftWeight}</if>
        </set>
        WHERE  REPORTNUMBER=#{reportNumber};
    </update>
    <update id="updateURL" parameterType="java.lang.String">
        UPDATE craneinspectreport
        <set>
            <if test="singlePicURL!=null">SINGLEPICURL=#{singlePicURL}</if>
        </set>
        WHERE REPORTNUMBER=#{reportNumber};
    </update>
    <select id="get" parameterType="map" resultMap="craneInspectReportResultMap">
        SELECT
        <include refid="craneInspectReport_fields"/>
        FROM craneinspectreport WHERE ID=#{id}
    </select>

     <select id="getReportNumber" parameterType="java.lang.String" resultType="java.lang.String">
         SELECT reportNumber
         FROM craneinspectreport
         WHERE REPORTNUMBER=#{reportNumber}
     </select>


    <select id="findByCondition" parameterType="map" resultMap="craneInspectReportResultMap">
        SELECT
        <include refid="craneInspectReport_fields"/>
        FROM craneinspectreport
        <where>
            <if test="reportNumber!=null">REPORTNUMBER=#{reportNumber}</if>
            <if test="unitAddress!=null">AND UNITADDRESS=#{unitAddress}</if>
            <if test="addressId!=null">AND ADDRESSID=#{addressId}</if>
            <if test="organizeCode!=null">AND ORGANIZECODE=#{organizeCode}</if>
            <if test="userPoint!=null">AND USEPOINT=#{userPoint}</if>
            <if test="safeManager!=null">AND SAFEMANAGER=#{safeManager}</if>
            <if test="contactPhone!=null">AND CONTACTPHONE=#{contactPhone}</if>
            <if test="equipmentVariety!=null">AND EQUIPMENTVARIETY=#{equipmentVariety}</if>
            <if test="unitNumber!=null">AND UNITNUMBER=#{unitNumber}</if>
            <if test="manufactureUnit!=null">AND MANUFACTUREUNIT=#{manufactureUnit}</if>
            <if test="manufactureLicenseNumber!=null">AND MANUFACTURELICENSENUMBER=#{manufactureLicenseNumber}</if>
            <if test="manufactureDate!=null">AND MANUFACTUREDATE=#{manufactureDate}</if>
            <if test="specification!=null">AND SPECIFICATION=#{specification}</if>
            <if test="pNumber!=null">AND PNUMBER=#{pNumber}</if>
            <if test="workLevel!=null">AND WORKLEVEL=#{workLevel}</if>
            <if test="singlePicURL!=null">AND SINGLEPICURL=#{singlePicURL} </if>
            <if test="typePicURL!=null">AND TYPEPICURL=#{typePicURL}</if>
            <if test="ratedLiftWeight">AND RATEDLIFTWEIGHT=#{ratedLiftWeight}</if>
        </where>
    </select>
    <delete id="delete" parameterType="CraneInspectReport">
        DELETE FROM craneinspectreport
            <where>
                <if test="id!=null">ID=#{id}</if>
            </where>
    </delete>

    <select id="getInfoByAddressId" parameterType="java.lang.Long" resultMap="craneInspectReportResultMap">
       SELECT
       <include refid="craneInspectReport_fields"/>
       FROM  craneinspectreport
       where addressId=#{addressId}
    </select>
    <select id="getInfoByUnitAddress" parameterType="java.lang.Long" resultMap="craneInspectReportResultMap">
     SELECT
     cr.*,r.riskValue,count(cr.reportnumber) as craneNumber
     FROM craneinspectreport cr,riskvalue r
     WHERE cr.reportnumber=r.reportnumber
     AND cr.unitAddress=#{unitAddress}
     GROUP BY cr.equipmentVariety
    </select>
    <select id="getCraneInspectReportInfoByAddressAndEquipment" parameterType="map" resultMap="craneInspectReportResultMap">
        SELECT
        cr.*,r.riskvalue
        FROM craneinspectreport cr,riskvalue r
        where cr.reportnumber=r.reportnumber AND unitAddress=#{unitAddress} and equipmentVariety=#{equipmentVariety} group by reportnumber
    </select>
    <select id="getCraneInspectReportByReportNumber" parameterType="java.lang.String" resultMap="craneInspectReportResultMap">
        SELECT
        <include refid="craneInspectReport_fields"/>
        FROM craneinspectreport
        WHERE reportNumber=#{reportNumber}
    </select>
    <select id="getUnitaddressByArea" parameterType="map"   resultMap="craneInspectReportResultMap">
        select
        distinct (unitaddress),lng,lat
        from craneinspectreport
        where
        addressid=(
        SELECT id
        FROM address
        <where>
            <if test="province != null">
                PROVINCE=#{province}
            </if>
            <if test="city != null">
                and CITY=#{city}
            </if>
            <if test="area != null">
                and AREA=#{area}
            </if>
        </where>
        )
    </select>
    <select id="findReportNumberByUnitAddress" parameterType="java.lang.String" resultType="java.lang.Long">
     SELECT round(avg(r.riskvalue))
     FROM craneinspectreport cr,riskvalue r
     WHERE cr.reportnumber=r.reportnumber
     AND cr.unitAddress=#{unitAddress}
    </select>
    <select id="showRiskRank" parameterType="map" resultMap="craneInspectReportResultMap">
         SELECT cr.id,cr.unitAddress,r.riskvalue
         FROM craneinspectreport cr,riskvalue r,address a
         WHERE cr.reportnumber=r.reportnumber
         AND a.id=cr.addressId AND a.city=#{city} AND a.area=#{area}
         group by cr.unitAddress order by r.riskvalue desc
    </select>
    <select id="showRiskRankByValueRange" parameterType="map" resultMap="craneInspectReportResultMap">
        SELECT cr.*,r.riskvalue,count(cr.reportnumber) as craneNumber
        FROM craneinspectreport cr,riskvalue r,address a
        WHERE cr.reportnumber=r.reportnumber
        AND a.id=cr.addressId AND a.city=#{city} AND a.area=#{area} AND r.riskvalue BETWEEN #{startValue} AND #{endValue}
        group by cr.unitAddress order by r.riskvalue desc
    </select>
    <select id="getOneUnitAddressInfo" parameterType="java.lang.String" resultMap="craneInspectReportResultMap">
           SELECT *
           FROM
           craneinspectreport
           WHERE unitAddress=#{unitAddress}
           GROUP BY unitAddress
    </select>
    <select id="getCraneInspectReportInfoById" parameterType="java.lang.Long" resultMap="craneInspectReportResultMap">
          SELECT
          *,riskvalue
          FROM
          craneinspectreport cr,riskvalue r
          WHERE cr.reportnumber=r.reportnumber AND cr.id=#{id}
    </select>
    <select id="getCraneInspectReportInfoFromCircle" parameterType="map" resultMap="craneInspectReportResultMap">
        SELECT cr.*,r.riskvalue
        FROM craneinspectreport cr,riskvalue r
        WHERE
        cr.reportnumber=r.reportnumber
        AND
        lng
        BETWEEN #{minLng}
        AND #{maxLng}
        AND lat
        BETWEEN #{minLat}
        AND #{maxLat}
        GROUP BY unitAddress
    </select>
    <select id="getEquipmentVarietyList" resultMap="craneInspectReportResultMap">
        SELECT DISTINCT(equipmentvariety)
        FROM craneinspectreport
    </select>

    <select id="getAvgRiskValueByProvince" parameterType="java.lang.String" resultType="java.lang.Float">
        SELECT ROUND(AVG(prs.riskvalue),2)
        FROM addressriskvalue prs
        INNER JOIN address a ON prs.addressid=a.id
        WHERE a.province=#{province}
    </select>
    <select id="getAvgRiskValueByProvinceAndCity" parameterType="map" resultType="java.lang.Float">
        SELECT ROUND(AVG(prs.riskvalue),2)
        FROM addressriskvalue prs
        INNER JOIN address a ON prs.addressid=a.id
        WHERE a.province=#{province} AND a.city=#{city}
    </select>
    <select id="getProvinceAvgRiskValue" resultType="map">
         SELECT a.province,ROUND(AVG(prs.riskvalue),2) avgRiskValue
         FROM addressriskvalue prs,address a
         WHERE a.id=prs.addressid
         group by a.province order by avgRiskValue desc
    </select>
    <select id="getCityAvgRiskValueByProvince" parameterType="java.lang.String" resultType="map">
         SELECT a.city,ROUND(AVG(prs.riskvalue),2) avgRiskValue
         FROM addressriskvalue prs,address a
         WHERE a.id=prs.addressid AND a.province=#{province}
         group by a.city order by avgRiskValue desc
    </select>
    <select id="getAreaAvgRiskValueByProvinceAndCity" parameterType="map" resultType="map">
        SELECT a.area,ROUND(AVG(prs.riskvalue),2) avgRiskValue
        FROM address a,addressriskvalue prs
        where a.id=prs.addressid AND a.province=#{province} AND a.city=#{city}
        GROUP BY a.area ORDER BY avgRiskValue DESC
    </select>
    <select id="fuzzyQuery"  parameterType="map" resultMap="craneInspectReportResultMap">
        SELECT cr.id,cr.unitAddress,r.riskvalue,cr.equipmentvariety,cr.lng,cr.lat
         FROM craneinspectreport cr,riskvalue r,address a
         WHERE cr.reportnumber=r.reportnumber
         AND a.id=cr.addressId AND a.city=#{city} AND a.area=#{area}
         AND (cr.unitaddress like #{require} or  cr.usepoint like #{require} or cr.safemanager like #{require} or cr.equipmentvariety like #{require}  or cr.manufactureunit like #{require})
         order by r.riskvalue desc
    </select>
    <select id="fuzzyQueryByUnitAddress" parameterType="map" resultMap="craneInspectReportResultMap">
        SELECT cr.id,cr.unitAddress,r.riskvalue,cr.equipmentvariety,cr.lng,cr.lat
        FROM craneinspectreport cr,riskvalue r,address a
        WHERE cr.reportnumber=r.reportnumber
        AND a.id=cr.addressId  AND a.city=#{city} AND a.area=#{area}
        AND cr.unitaddress like  #{require}
        order by r.riskvalue desc
    </select>
    <select id="fuzzyQueryByUserPoint" parameterType="map" resultMap="craneInspectReportResultMap">
        SELECT cr.id,cr.unitAddress,r.riskvalue,cr.equipmentvariety,cr.lng,cr.lat
        FROM craneinspectreport cr,riskvalue r,address a
        WHERE cr.reportnumber=r.reportnumber
        AND a.id=cr.addressId  AND a.city=#{city} AND a.area=#{area}
        AND cr.usePoint like  #{require}
        order by r.riskvalue desc
    </select>
    <select id="fuzzyQueryBySafeManager" parameterType="map" resultMap="craneInspectReportResultMap">
        SELECT cr.id,cr.unitAddress,r.riskvalue,cr.equipmentvariety,cr.lng,cr.lat
        FROM craneinspectreport cr,riskvalue r,address a
        WHERE cr.reportnumber=r.reportnumber
        AND a.id=cr.addressId  AND a.city=#{city} AND a.area=#{area}
        AND cr.safeManager like  #{require}
        order by r.riskvalue desc
    </select>
    <select id="fuzzyQueryByEquipmentVariety" parameterType="map" resultMap="craneInspectReportResultMap">
        SELECT cr.id,cr.unitAddress,r.riskvalue,cr.equipmentvariety,cr.lng,cr.lat
        FROM craneinspectreport cr,riskvalue r,address a
        WHERE cr.reportnumber=r.reportnumber
        AND a.id=cr.addressId  AND a.city=#{city} AND a.area=#{area}
        AND cr.equipmentVariety like  #{require}
        order by r.riskvalue desc
    </select>
    <select id="fuzzyQueryByManufactureUnit" parameterType="map" resultMap="craneInspectReportResultMap">
        SELECT cr.id,cr.unitAddress,r.riskvalue,cr.equipmentvariety,cr.lng,cr.lat
        FROM craneinspectreport cr,riskvalue r,address a
        WHERE cr.reportnumber=r.reportnumber
        AND a.id=cr.addressId  AND a.city=#{city} AND a.area=#{area}
        AND cr.manufactureUnit like  #{require}
        order by r.riskvalue desc
    </select>
    <select id="getAreaInfo" parameterType="map" resultMap="craneInspectReportResultMap">
        SELECT cr.*,r.riskvalue,count(cr.reportnumber) as craneNumber
        FROM craneinspectreport cr,address a,riskvalue r
        WHERE cr.reportnumber=r.reportnumber AND a.id=cr.addressId
        AND a.city=#{city} AND a.area=#{area} GROUP BY cr.unitaddress
    </select>
    <select id="getProvinceRiskRankFormRiskRange" parameterType="map" resultType="map">
        SELECT a.id,a.province,round(avg(r.riskvalue)) as riskvalue,count(cr.reportnumber) as craneNumber,col.riskcolor as color
        FROM craneinspectreport cr,riskvalue r,address a,riskcolor col
        WHERE cr.reportnumber=r.reportnumber AND col.riskvalue=r.riskvalue
        AND a.id=cr.addressId AND r.riskvalue BETWEEN #{startValue} AND #{endValue}
        group by a.province  order by r.riskvalue desc
    </select>
    <select id="getCityRiskRankFormRiskRange" parameterType="map" resultType="map">
        SELECT a.id,a.city,round(avg(r.riskvalue)) as riskvalue,count(cr.reportnumber) as craneNumber,col.riskcolor as color
        FROM craneinspectreport cr,riskvalue r,address a,riskcolor col
        WHERE cr.reportnumber=r.reportnumber AND col.riskvalue=r.riskvalue
        AND a.id=cr.addressId AND a.province=#{province}  AND r.riskvalue BETWEEN #{startValue} AND #{endValue}
        group by a.city  order by r.riskvalue desc
    </select>
    <select id="getAreaRiskRankFormRiskRange" parameterType="map" resultType="map">
       SELECT a.id,a.area,round(avg(r.riskvalue)) as riskvalue,count(cr.reportnumber) as craneNumber,col.riskcolor as color
        FROM craneinspectreport cr,riskvalue r,address a,riskcolor col
        WHERE cr.reportnumber=r.reportnumber AND col.riskvalue=r.riskvalue
        AND a.id=cr.addressId AND a.province=#{province} AND a.city=#{city} AND r.riskvalue BETWEEN #{startValue} AND #{endValue}
        group by a.area  order by r.riskvalue desc
    </select>

    <select id="getCraneInfoByFuzzyUnitAddress" parameterType="map" resultType="java.lang.String">
        SELECT DISTINCT cr.unitaddress
        FROM craneinspectreport cr,address a
        WHERE cr.addressid=a.id AND a.city=#{city} AND a.area=#{area}  AND cr.unitaddress LIKE #{require}
    </select>
    <select id="getCraneInfoByFuzzyUsePoint" parameterType="map" resultType="java.lang.String">
        SELECT DISTINCT cr.usepoint
        FROM craneinspectreport cr,address a
        WHERE cr.addressid=a.id AND a.city=#{city} AND a.area=#{area}  AND cr.usepoint LIKE #{require}
    </select>
    <select id="getCraneInfoByFuzzySafeManager" parameterType="map" resultType="java.lang.String">
        SELECT DISTINCT cr.safemanager
        FROM craneinspectreport cr,address a
        WHERE cr.addressid=a.id AND a.city=#{city} AND a.area=#{area}  AND cr.safemanager LIKE #{require}
    </select>
    <select id="getCraneInfoByFuzzyEquipmentVariety" parameterType="map" resultType="java.lang.String">
        SELECT DISTINCT cr.equipmentvariety
        FROM craneinspectreport cr,address a
        WHERE cr.addressid=a.id AND a.city=#{city} AND a.area=#{area}  AND cr.equipmentvariety LIKE #{require}
    </select>
    <select id="getCraneInfoByFuzzyManufactureunit" parameterType="map" resultType="java.lang.String">
        SELECT DISTINCT cr.manufactureunit
        FROM craneinspectreport cr,address a
        WHERE cr.addressid=a.id AND a.city=#{city} AND a.area=#{area}  AND cr.manufactureunit LIKE #{require}
    </select>
    <select id="getCraneNumberByUnitAddress" parameterType="java.lang.String" resultType="java.lang.Long">
         SELECT
         count(*)
         FROM craneinspectreport cr
         WHERE cr.unitAddress=#{unitAddress}
         GROUP BY cr.unitAddress
    </select>
    <select id="getUseTimeList" resultType="java.lang.String">
        SELECT round(DATEDIFF(NOW(),cr.manufacturedate)/365) as useTime
        FROM craneinspectreport cr GROUP BY useTime order by useTime asc
    </select>
    <select id="getCraneInfoByCondition" parameterType="map" resultMap="craneInspectReportResultMap">
        SELECT cr.*,r.riskvalue,count(cr.reportnumber) as craneNumber
        FROM craneinspectreport cr,address a,riskvalue r
        WHERE cr.addressid=a.id AND cr.reportnumber=r.reportnumber
        <if test="province!=null">
            AND a.province=#{province}
        </if>
        <if test="city!=null">
            AND a.city=#{city}
        </if>
        <if test="area!=null">
            AND a.area=#{area}
        </if>
        <if test="equipmentVariety!='0'">
            AND cr.equipmentvariety=#{equipmentVariety}
        </if>
        <if test="useTime!='0'">
            AND ROUND(DATEDIFF(NOW(),cr.manufacturedate)/365)=#{useTime}
        </if>
        <if test="startValue!=0f">
            AND r.riskvalue BETWEEN #{startValue}
        </if>
        <if test="endValue!=0f">
            AND #{endValue}
        </if>
        GROUP BY cr.unitaddress
    </select>
    <select id="getCityInfoByCondition" parameterType="map" resultType="map">
        SELECT a.id,a.city,r.riskvalue,count(cr.reportnumber) as craneNumber,col.riskcolor as color
        FROM craneinspectreport cr,address a,riskvalue r,riskcolor col
        WHERE cr.addressid=a.id AND cr.reportnumber=r.reportnumber AND col.riskvalue=r.riskvalue
        <if test="province!=null">
            AND a.province=#{province}
        </if>
        <if test="equipmentVariety!='0'">
            AND cr.equipmentvariety=#{equipmentVariety}
        </if>
        <if test="useTime!='0'">
            AND ROUND(DATEDIFF(NOW(),cr.manufacturedate)/365)=#{useTime}
        </if>
        <if test="startValue!=0f">
            AND r.riskvalue BETWEEN #{startValue}
        </if>
        <if test="endValue!=0f">
            AND #{endValue}
        </if>
        GROUP BY a.city
    </select>
    <select id="getAreaInfoByCondition" parameterType="map" resultType="map">
         SELECT a.id,a.area,r.riskvalue,count(cr.reportnumber) as craneNumber,col.riskcolor as color
        FROM craneinspectreport cr,address a,riskvalue r,riskcolor col
        WHERE cr.addressid=a.id AND cr.reportnumber=r.reportnumber AND col.riskvalue=r.riskvalue
         <if test="province!=null">
             AND a.province=#{province}
         </if>
        <if test="city!=null">
            AND a.city=#{city}
        </if>
        <if test="equipmentVariety!='0'">
            AND cr.equipmentvariety=#{equipmentVariety}
        </if>
        <if test="useTime!='0'">
            AND ROUND(DATEDIFF(NOW(),cr.manufacturedate)/365)=#{useTime}
        </if>
        <if test="startValue!=0f">
            AND r.riskvalue BETWEEN #{startValue}
        </if>
        <if test="endValue!=0f">
            AND #{endValue}
        </if>
        GROUP BY a.area
    </select>
</mapper>