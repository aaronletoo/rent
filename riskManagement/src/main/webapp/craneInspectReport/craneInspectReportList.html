<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link href="lib/ligerUI/skins/Aqua/css/ligerui-all.css" rel="stylesheet" type="text/css" />
    <script src="lib/json2.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerDialog.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerTextBox.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerCheckBox.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerComboBox.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerGrid.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerDateEditor.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerSpinner.js" type="text/javascript"></script>
    <script type="text/javascript">

        $(function(){
            $.get($.URL.craneInspectReport.list ,null,listCallback,"json");
        });

        var gridData = {};
        function listCallback(data){
            if(data.code==200){
                gridData.Rows = data.data;
                gridData.Total = data.data.length;
                f_initGrid();
            }
        }
        var manager, g;
        function f_initGrid()
        {
            g = manager = $("#maingrid").ligerGrid({
                columns: [
                    { display:'操作',isSort:false,width:180,render:function(rowdata,rowindex,value)
                    {
                        var h="";
                        if(!rowdata._editing){
                            h+="<a href='javascript:beginEdit("+rowindex+")'>修改图片</a>";
                            h+="<a href='javascript:deleteRow("+rowindex+")'>删除记录</a>";
                        }
                        else
                        {
                            h += "<a href='javascript:endEdit(" + rowindex + ")'>提交</a> ";
                            h += "<a href='javascript:cancelEdit(" + rowindex + ")'>取消</a> ";
                        }
                        return h;
                    }},
                    { display: '图片', name: 'singlePicURL', width: 50 },
                    { display: '报告书编号', name: 'reportNumber', width: 180 },
                    { display: '单位地址', name: 'unitAddress', width: 200 },
                    { display: '地址ID', name: 'addressId', width: 50 },
                    { display: '组织机构代码', name: 'organizeCode', width: 100 },
                    { display: '使用地点', name: 'userPoint', width: 50 },
                    { display: '安全管理人员', name: 'safeManager', width: 50 },
                    { display: '联系电话', name: 'contactPhone', width: 100 },
                    { display: '设备品种', name: 'equipmentVariety', width: 120 },
                    { display: '单位内部编号', name: 'unitNumber', width: 100 },
                    { display: '制造单位', name: 'manufactureUnit', width: 180 },
                    { display: '制造许可编号', name: 'manufactureLicenseNumber', width: 120 },
                    { display: '制造日期', name: 'manufactureDate', width: 120 },
                    { display: '规格型号', name: 'specification', width: 180 },
                    { display: '产品编号', name: 'pNumber', width: 120 },
                    { display: '工作级别', name: 'workLevel', width: 50 },
                    { display: '经度', name: 'lng', width: 100 },
                    { display: '纬度', name: 'lat', width: 100 }
                ],
                onSelectRow: function (rowdata, rowindex)
                {
                    $("#txtrowindex").val(rowindex);
                },
                enabledEdit: true,clickToEdit:false, isScroll: true,
                data: $.extend(true,{},gridData),where:f_getWhere(),
                dataAction: 'server', pageSize: 20, toolbar: {},
                width: '100%',height:'100%'
            });
        }
        function beginEdit(rowid) {
            manager.beginEdit(rowid);
            $.ligerDialog.open({
                target: $("#AppendBill_Div"), title: '添加图标',
                width: 360, height: 170, top: 170, left: 280,  // 弹出窗口大小
                buttons: [
                    { text: '上传', onclick: function () { }},
                    { text: '取消', onclick: function () { } }
                ]
            });
        }
        function cancelEdit(rowid) {
            manager.cancelEdit(rowid);
        }
        function endEdit(rowid)
        {
        }

        function updateCallback(data){
            if(data.code==200){
                $.ligerDialog.success("修改成功");
            }
        }

        function deleteRow(rowid)
        {
            if (confirm('确定删除?'))
            {
                var row = manager.getRow(rowid);
                var jsonString  = $.toJSON(row);
                $.post($.URL.craneInspectReport.delete,{"jsonString":jsonString},deleteCallback,"json");
                manager.deleteRow(rowid);
            }
        }
        function deleteCallback(data){
            if(data.code==200){
                $.ligerDialog.success("成功删除！");
            }else{
                $.ligerDialog.success("删除失败！");
            }
        }
        function f_search()
        {
            g.options.data = $.extend(true, {}, gridData);
            g.loadData(f_getWhere());
        }
        function f_getWhere()
        {
            if (!g) return null;
            var clause = function (rowdata, rowindex)
            {
                var key = $("#reportNumber").val();
                return rowdata.reportNumber.indexOf(key)>-1;
            };
            return clause;
        }
        function f_queryRiskValue(){

        }
    </script>

</head>
<body style="padding:6px; overflow:hidden;">
<div class="l-clear"></div>
<div id="searchbar">
    报告书编号：<input id="reportNumber" type="text" style="width: 200"/>
    <input id="btnOK" type="button" value="查询" style="width: 80" onclick="f_search()" />
    <input id="riskValue" type="text" style="width: 120;float: right"/>
    <input id="btnQueryRiskValue" type="button" value="获得平均风险值" style="width: 80;float: right" onclick="f_queryRiskValue"/>

</div>
<div id="maingrid" style="margin: 0;padding: 0"></div>

<div id="AppendBill_Div"  style="display:none;">
    <table style="height:100%;width:100%">
        <tr style="height:40px">
            <td style="width:20%">
                选择图片
            </td>
            <td><input type="file"  style="width:200px" id="fileupload" name="fileupload"/>
            </td>
        </tr>
    </table>
</div>

<br/>

<div style="display:none;">
    <!-- g data total ttt -->
</div>
</body>
</html>
