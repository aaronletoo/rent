<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link href="lib/ligerUI/skins/Aqua/css/ligerui-all.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="css/report.css">
    <link rel="stylesheet" href="css/reportShow.css">
    <script src="lib/ligerUI/js/plugins/ligerForm.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerDateEditor.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerComboBox.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerCheckBox.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerButton.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerDialog.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerRadio.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerSpinner.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerTextBox.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerDateEditor.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerTab.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerDrag.js" type="text/javascript"></script>
    <script src="lib/ligerUI/js/plugins/ligerGrid.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function(){
            $.get($.URL.user.list,null,userListCallback,"json");
            $.get($.URL.device.list,null,listCallback,"json");
            $.post($.URL.inspectReport.getInspectTableRecordList,null,getInspectTableRecordListCallback,"json");

        });
            function userListCallback(data){
                if(data.code==200){
                    var userData=[];
                    for(i=0;i<data.length;i++){
                        var d={};
                        d['text']=data.data[i].name;
                        d['id']=data.data[i].id;
                        userData.push(d);
                    }
                    $("#txt2").ligerComboBox({
                        data:userData,valueFieldID:"txt2"
                    });
                    $("#txt6").ligerComboBox({
                        data:userData,valueFieldID:"txt2"
                    });
                }
            }
            function listCallback(data){
                if(data.code==200){
                    var deviceData=[];
                    for(i=0;i<data.length;i++){
                        var d={};
                        d['text']=data.data[i].name;
                        d['id']=data.data[i].id;
                        deviceData.push(d);
                    }
                    $("#txt3").ligerComboBox({
                        data:deviceData,valueFieldID:"txt3"
                    });
                    $("#txt7").ligerComboBox({
                        data:deviceData,valueFieldID:"txt3"
                    });
                }
            }
            var peopleRecordData={};
            function getInspectTableRecordListCallback(data){
                 if(data.code==200){
                     if(data.data[0]==undefined){
                           $("#maingrid").html("抱歉,没有相关信息!");
                           $("#devicegrid").html("抱歉,没有相关信息!");
                     }else{
                         peopleRecordData.Rows = data.data;
                         peopleRecordData.Total = data.data.length;
                         f_peopleRecord();
                         f_deviceRecord();
                     }
                 }
            }
            $("#tab1").ligerTab();
            $("#txt4").ligerDateEditor();
            $("#txt5").ligerDateEditor();
            $("#txt8").ligerDateEditor();
            $("#txt9").ligerDateEditor();
        var manager, g;
        function f_peopleRecord()
        {
            g = manager = $("#maingrid").ligerGrid({
                columns: [
                    { display: '点检人员', name: 'username',
                        editor: { type: 'text' }
                    },
                    { display: '点检项目', name: 'tablename', type: 'string',
                        editor: { type: 'text' }
                    },
                    { display: '点检时间', name: 'createtime',
                        editor: { type: 'text' }
                    },
                    { display: '异常数', name: 'exceptioncount', hidden:'mongoId',
                        editor: { type: 'text' }
                    },
                    { display: '操作', isSort: false, width: 120, render: function (rowdata, rowindex, value)
                    {
                        var h = "";
                        h += "<a href='javascript:getInfo(" + rowindex + ")'>详情</a> ";
                        return h;
                    }
                    }
                ],
                onSelectRow: function (rowdata, rowindex)
                {
                    $("#txtrowindex").val(rowindex);
                },
                enabledEdit: true,clickToEdit:false, isScroll: false,
                data: peopleRecordData,
                width: '100%',
                groupColumnDisplay:'员工类型',groupColumnName:'employeeRoleName'
            });
        }
        var manager1, g1;
        function f_deviceRecord()
        {
            g1 = manager1 = $("#devicegrid").ligerGrid({
                columns: [
                    { display: '点检设备', name: 'devname', width:249,
                        editor: { type: 'text' }
                    },
                    { display: '点检人员', name: 'username', type: 'string', width:249,
                        editor: { type: 'text' }
                    },
                    { display: '点检时间', name: 'createtime', width:249,
                        editor: { type: 'text' }
                    },
                    { display: '异常数', name: 'exceptioncount',width:249,
                        editor: { type: 'text' }
                    },
                    { display: '操作', isSort: false, width: 120, render: function (rowdata, rowindex, value)
                    {
                        var h = "";
                        h += "<a href='javascript:getDevInfo(" + rowindex + ")'>详情</a> ";
                        return h;
                    }
                    }
                ],
                onSelectRow: function (rowdata, rowindex)
                {
                    $("#txtrowindex").val(rowindex);
                },
                enabledEdit: true,clickToEdit:false, isScroll: false,
                data: peopleRecordData,
                width: '100%',
                groupColumnDisplay:'设备类型',groupColumnName:'typename'
            });
        }
        function getInfo(rowid){
            var row=manager.getRow(rowid);
            var jsonString= $.toJSON(row);
            $("#maingrid").css("display","none");
            $("#exportDiv").css("display","block");
            $("#reportShow").load($.URL.inspectReport.getInspectInfo,{"jsonString":jsonString,"type":"html"},getInspectInfoCallback,"json");
        }
        function getDevInfo(rowid){
            var row=manager1.getRow(rowid);
            var jsonString= $.toJSON(row);
            $("#devicegrid").css("display","none");
            $("#exportDeviceDiv").css("display","block");
            $("#devReportShow").load($.URL.inspectReport.getInspectInfo,{"jsonString":jsonString,"type":"html"},getInspectInfoCallback,"json");
        }
        function getInspectInfoCallback(data){
        }
        $("#exportType").ligerComboBox({
            data: [
                { text: 'pdf', id: '1' },
                { text: 'word', id: '2' },
                { text: 'excel', id: '3' }
            ], valueFieldID: 'exportType'
        });
        $("#exportBtn").click(function(){
            var type=$("#exportType").val();
            if(type!=null){
                location.href= "rs/inspectReport/exportPeopleInfoReport/"+type;
            }else{
                $.ligerDialog().alert("请输入导出报表类型!");
            }
        });
        $("#exportDevType").ligerComboBox({
            data: [
                { text: 'pdf', id: '1' },
                { text: 'word', id: '2' },
                { text: 'excel', id: '3' }
            ], valueFieldID: 'exportDevType'
        });
        $("#exportDevBtn").click(function(){
            var type=$("#exportDevType").val();
            if(type!=null){
                location.href= "rs/inspectReport/exportPeopleInfoReport/"+type;
            }else{
                $.ligerDialog().alert("请输入导出报表类型!");
            }
        });
    </script>

</head>
<body>
     <div id="tab1">
         <div title="人员日检">
             <div class="searchContainer">
                 <div class="searchItem"><span class="item_font">设备编号:</span><span class="item_input"><input id="txt2" type="text"></span></div>
                 <div class="searchItem"><span class="item_font">点检人员:</span><span class="item_input"><input id="txt3" type="text"></span></div>
                 <div class="searchItem"><span class="item_font">起始时间:</span><span class="item_input"><input id="txt4" type="text"></span></div>
                 <div class="searchItem"><span class="item_font">终止时间:</span><span class="item_input"><input id="txt5" type="text"></span></div>
                 <div class="btn"><span><input type="button" value="查看" id="submitBtn1" class="l-button l-button-submit" /></span></div>
             </div>
             <div class="exportDiv" id="exportDiv">
                 <span class="exportType">
                    <span class="type_font">导出类型:</span><span class="type_input"><input type="text" id="exportType"></span>
                 </span>
                 <span class="exportBtn"><span><input type="button" value="导出" id="exportBtn" class="l-button l-button-submit" /></span></span>
             </div>
             <div class="reportContent">
                  <div id="maingrid"></div>
                  <div id="reportShow"></div>
             </div>
         </div>
         <div title="设备日检">
             <div class="searchContainer">
                 <div class="searchItem"><span class="item_font">设备编号:</span><span class="item_input"><input id="txt6" type="text"></span></div>
                 <div class="searchItem"><span class="item_font">点检人员:</span><span class="item_input"><input id="txt7" type="text"></span></div>
                 <div class="searchItem"><span class="item_font">起始时间:</span><span class="item_input"><input id="txt8" type="text"></span></div>
                 <div class="searchItem"><span class="item_font">终止时间:</span><span class="item_input"><input id="txt9" type="text"></span></div>
                 <div class="btn"><span><input type="button" value="查看" id="submitBtn2" class="l-button l-button-submit" /></span></div>
             </div>
             <div class="exportDiv" id="exportDeviceDiv">
                 <span class="exportType">
                    <span class="type_font">导出类型:</span><span class="type_input"><input type="text" id="exportDevType"></span>
                 </span>
                 <span class="exportBtn"><span><input type="button" value="导出" id="exportDevBtn" class="l-button l-button-submit" /></span></span>
             </div>
             <div class="reportContent">
                    <div id="devicegrid"></div>
                    <div id="devReportShow"></div>
             </div>
         </div>
     </div>
</body>
</html>